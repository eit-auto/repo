<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Datatable Config Builder</title>
    <link rel="stylesheet" href="https://eit-auto.github.io/repo/rewst-library.css?v=3.2.2">
    <style>

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            min-height: 100vh;
            padding: 0;
            margin: 0;
        }

        .search-container {
            padding: 1rem;
            background: #1f4051;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-input-wrapper {
            flex: 1;
            min-width: 300px;
            display: flex;
        }

        .search-input {
            width: 100%;
            height: 40px;
            padding: 0 0.75rem;
            border: 2px solid #404040;
            border-radius: 4px;
            font-size: 0.95rem;
            background: #2a2a2a;
            color: #e0e0e0;
            transition: all 0.2s ease;
            box-sizing: border-box;
        }

        .search-input:focus {
            outline: none;
            border-color: #5a9fb8;
            box-shadow: 0 0 0 3px rgba(90, 159, 184, 0.1);
        }

        .search-input::placeholder {
            color: #888;
        }

        .grey-panel {
            margin-bottom: 1.5rem;
            display: flex;
            flex-direction: column;
            background: #2a2a2a;
            border-radius: 4px;
            padding: 0.75rem;
            border: 1px solid #404040;
        }

        .grey-panel:last-child {
            margin-bottom: 0;
        }

        .gp-two-column {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 1rem;
        }

        .gp-panel-left {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .gp-panel-right {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            gap: 0.5rem;
        }

        .gp-row {
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
        }

        .gp-row label {
            color: #e0e0e0;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .gp-row input[type="text"],
        .gp-row select {
            background: #1a1a1a;
            border: 1px solid #404040;
            color: #e0e0e0;
            padding: 0.5rem;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .gp-button-row {
            display: flex;
            gap: 0.25rem;
        }

        .gp-move-btn {
            background: #2E5F75;
            color: #e0e0e0;
            border: none;
            border-radius: 4px;
            padding: 0.4rem 0.6rem;
            cursor: pointer;
            font-size: 0.8rem;
            flex: 1;
        }

        .gp-move-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .gp-move-btn:hover:not(:disabled) {
            background: #3a7a99;
        }

        .gp-row-grid2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.85rem;
        }

        .checkbox-item input[type="checkbox"] {
            cursor: pointer;
        }

        .checkbox-item label {
            color: #e0e0e0;
            cursor: pointer;
        }

        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #2E5F75;
        }

        .tab-btn {
            padding: 0.75rem 1rem;
            background: transparent;
            border: none;
            color: #888;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
        }

        .tab-btn:hover {
            color: #5a9fb8;
        }

        .tab-btn.active {
            color: #5a9fb8;
            border-bottom-color: #5a9fb8;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .output-content {
            background: #2a2a2a;
            border-radius: 4px;
            padding: 1rem;
            font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
            font-size: 0.85rem;
            color: #e0e0e0;
            white-space: pre-wrap;
            word-break: break-all;
            line-height: 1.5;
            overflow-x: auto;
        }

        .inner-panel {
            background: #1f4051;
            border-radius: 8px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
        }

        .inner-panel h2 {
            color: #ffffff;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding-bottom: 0.5rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 0.7fr 1fr 0.7fr;
            gap: 1.5rem;
            padding: 1rem;
        }
    </style>
</head>
<body>
    <div class="main-panel">
        <div style="padding: 0.5rem 1rem; display: flex; justify-content: space-between; align-items: flex-start; gap: 1rem;">
            <h1 style="color: #ffffff; margin: 0; font-size: 1.5rem; padding: 0;">DataTable Configuration Builder</h1>
            <div style="display: flex; gap: 0.5rem; align-items: flex-start; flex: 1; justify-content: center;">
                <div class="form-container">
                    <div class="form-container"><div class="form-group">
                        <select id="existingConfigDropdown" onchange="updateLoadButtonState()">
                            <option value="">-- Existing DataTable Configuration --</option>
                        </select>
                    </div></div>
                </div>
                <button id="loadConfigBtn" class="btn btn-green" onclick="loadSelectedConfig()" disabled>Load</button>
            </div>
            <div style="display: flex; gap: 0.5rem;">
                <button id="deleteBtn" class="btn btn-red" onclick="deleteConfiguration()" disabled>Delete</button>
                <button id="saveBtn" class="btn btn-green" onclick="saveConfiguration()">Save</button>
                <button id="resetBtn" class="btn btn-bluegrey" onclick="resetConfiguration()">Reset</button>
            </div>
        </div>

        <div class="main-content" id="mainContent">
            <div class="inner-panel">
                <h2>Basic Configuration</h2>

                <div style="margin-bottom: 1.5rem;">
                    <label style="color: #e0e0e0; font-weight: 600; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.5rem; display: block;">Datatable Name</label>
                    <input type="text" id="datatableName" placeholder="e.g., automation_requests" style="width: 100%; padding: 0.5rem; background: #2a2a2a; border: 1px solid #404040; border-radius: 4px; color: #e0e0e0;">
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label style="color: #e0e0e0; font-weight: 600; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.5rem; display: block;">Description</label>
                    <textarea id="datatableDesc" placeholder="Describe this data table..." style="width: 100%; padding: 0.5rem; background: #2a2a2a; border: 1px solid #404040; border-radius: 4px; color: #e0e0e0; min-height: 80px;"></textarea>
                </div>

                <div style="margin-bottom: 1.5rem; border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 1rem;">
                    <h3 style="color: #ffffff; margin: 0 0 1rem 0; font-size: 1rem;">Filters</h3>
                    <div id="filtersList"></div>
                    <button class="btn btn-blue" onclick="addFilter()">+ Add Filter</button>
                </div>
            </div>

            <div class="inner-panel">
                <h2>Workflows & Data</h2>
            </div>

            <div class="inner-panel">
                <h2>Column Settings</h2>
                <div id="columnsList"></div>
            </div>
        </div>

        <div style="padding: 0.5rem 1rem; display: flex; justify-content: center;">
            <div class="inner-panel" style="width: 100%;">
                <div class="tabs">
                    <button class="tab-btn active" onclick="switchTab('validation')">Validation</button>
                    <button class="tab-btn" onclick="switchTab('json')">JSON Output</button>
                </div>

                <div id="validationTab" class="tab-content active">
                    <div id="validationOutput" style="font-size: 0.9rem; color: #e0e0e0;"></div>
                </div>

                <div id="jsonTab" class="tab-content">
                    <div class="output-content" id="jsonOutput"></div>
                    <button class="btn btn-blue btn-small" onclick="copyToClipboard('jsonOutput')">Copy JSON</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        window.ORG_ID = '019176c2-059f-7391-afbc-97b201efbd93';
    </script>
    <script src="https://eit-auto.github.io/repo/rewst-library.js"></script>
    <script>
        let filters = [];
        let columns = [];
        let jsonOutput = null;
        let validationOutput = null;
        let filtersList = null;
        let columnsList = null;

        function initializeApp() {
            jsonOutput = document.getElementById('jsonOutput');
            validationOutput = document.getElementById('validationOutput');
            filtersList = document.getElementById('filtersList');
            columnsList = document.getElementById('columnsList');
        }

        function addFilter() {
            filters.push({ col_name: '' });
            renderFilters();
            updateOutput();
        }

        function removeFilter(idx) {
            filters.splice(idx, 1);
            renderFilters();
            updateOutput();
        }

        function moveFilter(idx, direction) {
            if (direction === 'up' && idx > 0) {
                [filters[idx - 1], filters[idx]] = [filters[idx], filters[idx - 1]];
            } else if (direction === 'down' && idx < filters.length - 1) {
                [filters[idx], filters[idx + 1]] = [filters[idx + 1], filters[idx]];
            }
            renderFilters();
            updateOutput();
        }

        function updateFilterByIndex(idx, field, value) {
            if (filters[idx]) {
                filters[idx][field] = value;
                updateOutput();
            }
        }

        function renderFilters() {
            if (filters.length === 0) {
                filtersList.innerHTML = '';
                return;
            }

            filtersList.innerHTML = filters.map((filter, idx) => `
                <div class="grey-panel gp-two-column">
                    <div class="gp-panel-left">
                        <div class="gp-row">
                            <label>Column Name</label>
                            <input type="text" value="${filter.col_name}" 
                                   placeholder="Column name" 
                                   onchange="updateFilterByIndex(${idx}, 'col_name', this.value)">
                        </div>
                    </div>
                    <div class="gp-panel-right">
                        <div class="gp-button-row">
                            <button onclick="moveFilter(${idx}, 'up')" ${idx === 0 ? 'disabled' : ''} class="gp-move-btn">▲</button>
                            <button onclick="moveFilter(${idx}, 'down')" ${idx === filters.length - 1 ? 'disabled' : ''} class="gp-move-btn">▼</button>
                        </div>
                        <button class="btn btn-red btn-small" onclick="removeFilter(${idx})">Remove</button>
                    </div>
                </div>
            `).join('');
        }

        function updateOutput() {
            jsonOutput.textContent = JSON.stringify({
                filters: filters,
                updated: new Date().toISOString()
            }, null, 2);
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            
            const tabId = tabName + 'Tab';
            const tabEl = document.getElementById(tabId);
            const btnEl = event.target;
            
            if (tabEl) tabEl.classList.add('active');
            if (btnEl) btnEl.classList.add('active');
        }

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                alert('Copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy:', err);
            });
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
    </script>
</body>
</html>